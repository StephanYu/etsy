<div class="container listings-container">
  <div class="row">
    <div class="col-md-6">
      <div class="thumbnail">
        <%= image_tag @listing.image.url %>    
      </div>
    </div>
    <div class="col-md-6">
      <h3><%= @listing.name %></h3>
      <p><%= number_to_currency(@listing.price) %></p>
      <p><%= @listing.description %></p>
      <p><%= "posted by #{@listing.user.first_name.capitalize} #{@listing.user.last_name.capitalize[0]}." %></p>

      <div class="star-rating" data-score= <%= @avg_rating %> >Average Rating:   </div>
      <p><%= "from a total of #{@reviews.length} reviews" %></p>
      <br>
      <div class="center">
        <%= link_to 'Buy Now', new_listing_order_path(@listing), class: 'btn btn-primary', data: { no_turbolink: true }  %>
        <%= link_to 'Write Review', new_listing_review_path(@listing), class: 'btn btn-primary', data: { no_turbolink: true }  %>
      </div>
    </div>
  </div>
  <div class="col-md-12">
    <% if @reviews.blank? %>
      <h4>No reviews yet. Be the first to write one!</h4>
    <% else %>
      <table class="table">
        <tbody>
          <% @reviews.each do |review| %>
            <tr>
              <td>
                <div class="star-rating" data-score= <%= review.rating %> ></div>
                <br>
                <p><%= h(review.comment).gsub(/\n/, '<br/>').html_safe %></p>
                <p><%= "posted by #{review.user.first_name.capitalize} #{review.user.last_name.capitalize[0]}." %></p>
                <p><%= review.created_at.strftime("%-m/%-d/%-y") %></p>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% end %>
  </div>

  <% if current_user == @listing.user %>
    <%= link_to 'Edit', edit_listing_path(@listing), class: 'btn btn-link' %> |
  <% end %>
  <%= link_to 'Back', listings_path, class: 'btn btn-link' %>
</div>

<script>
  $('.star-rating').raty({
    // path: "https://dl.dropboxusercontent.com/1/view/wwlnr96k58yxvk9/Apps/Etsyreborn/stars",
    path: "/assets",
    readOnly: true,
    score: function() {
      return $(this).attr('data-score');
    }
  });
</script>